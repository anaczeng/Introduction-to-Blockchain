IBM超级账本的主要目的是服务于产业界：作为一种商对商（B2B），商对客（B2C）交易的协议，在商业合同，资产托管，供应链等领域发挥作用。它是现业界众多联盟链的蓝本，区块链服务只是其逻辑架构的一部分。超级账本与比特币及以太坊有着本质的区别：它拥有中心，服从监管。换句话说，超级账本是有权限的共享帐本。

#### 6.2.1 架构

超级账本的逻辑架构包括三部分：会员制（Membership），区块链服务（Blockchain）和链上代码（Chiancode）。会员制是中心化的机制：权威中心作为看门人，参与者需要注册并通过中心的审核才能参与其中。区块链服务是指采用区块链账本的数据结构；在共识方面超级账本自带实用拜占庭容错（PBFT）的算法，但也可以采用POW等其他的共识机制。链上代码是去中心化的交易程序。

#### 6.2.2 共识机制：PBFT（实用拜占庭容错）

PBFT算法在错误节点不超过总结点数的三分之一的情况下，能保证系统各个节点执行一致的操作。PBFT算法类似于拜占庭将军中的书面协议，淡忘的读者可回顾之前的3.1.5章节。在书面协议中，只要将军是诚实的，那么诚实的副官都会执行他的命令。在PBFT中，视图（View）是该算法中很重要的一个概念，它是指一个特定主节点（primary）和其备份节点（backup）的集合。主节点可看做是将军，备份节点可看做是它的副官。视图的意义在于确定主节点是诚实的，即它没有出现故障（停止工作或发送错误信息等）。

正常情况下，用户（client）向主节点发送请求后，一个视图便开始三个阶段的消息确认以达到最后执行一致操作的目的。

![](/assets/fig-6-9.png)

图6-9：PBFT算法示意图。当一个备份节点出现错误时，在该例中并不会影响一致性。

PBFT算法的基本过程：

（1）    Request阶段：用户将请求发给主节点；

（2）    Pre-prepare阶段：主节点转发请求给备份节点；

（3）    Prepare阶段：备份节点转发主节点Pre-prepare阶段的信息；

（4）    Commit阶段：主节点及备份节点转发自己在Prepare阶段收到的信息。

当主节点和备份节点在Commit阶段都收到2f+1（f是错误节点个数）个相同的消息，则可确认诚实的节点都收到相同的消息，它们开始执行信息中用户请求的操作。

如果主节点出现了故障，PBFT就会触发改变视图（view-change）机制，也即是更换主节点。改变视图的操作是由备份节点的计时器超时触发的。

PBFT算法是去中心化的，但它并没有考虑女巫攻击的情况。在超级账本的背景下，女巫攻击的情况可被忽略，因为它有一个中心化的会员制来确定每个节点的身份。超级账本的理念与最初的区块链出现的意义某种程度上是背道而驰的。超级账本含有中心，它可以监管各个节点。因此，挖矿在超级账本中就不是一个需要的选项。

