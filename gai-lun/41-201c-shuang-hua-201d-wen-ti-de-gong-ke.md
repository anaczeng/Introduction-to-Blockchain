#### 4.1.1 “双花”问题（double spending）

比特币是数字货币\_的一种，其本质是字符串。未加约束的数字化信息是极易被复制黏贴和篡改的；"双花"问题就是该性质在数字货币领域的具体表现。让我们先看下面的例子：

> 盗跖事先复制了好几份“1两银子”数字货币的字符串。他先在张记瓜果用一份字符串购买了西瓜，然后到李家酒馆用三份字符串换得了黄酒。随后，盗跖为了省事将“1两银子”篡改为“5两银子”的面值，在王哥肉铺买了十斤牛肉…因为该数字货币未加任何约束，所以盗跖可以随意的复制黏贴及篡改并将它们流通出去。

![](/assets/fig-4-1.png)

_图4-1：“双花”流程示意图。当伪造的数字流通到市场后，货币总量增加了七倍。_

未加约束的数字货币就如没有防伪标志的纸币，而且伪造起来更简易廉价。“双花”问题可以表述为因伪造简易廉价而可重复使用已花费出去的“钱”，就如上述例子中盗跖可以不断伪造"1块钱"进行消费。从某种意义上说，“双花”行为等同于个人“发钞”；每“双花”一次，货币流通量就增加了“双花”一次的份额。

要解决"双花"问题，必须要有办法达成以下3个目标：

（1）盗跖的钱必须能被认证，也即是别人不能冒充盗跖使用她的钱做交易。

（2）盗跖花出去的钱是不可抵赖的，也即是盗跖花费出去"1块钱"，他不可以抵赖交易从未发生。

以上两个目标是否很熟悉？只需要使用第二章介绍的数字签名技术即可保障。

（3）在（1）和（2）的基础上，所有人都要知道盗跖花费出去的"1块钱"已经被使用了。

第三个目标的解决方案将在下一节具体介绍，现在暂且假设每个参与者都拥有一本信息一致的账本。有了解决办法，就让我们回到刚才的例子：

> 盗跖在张记瓜果消费"1块钱"，张记可以确认这张"1块钱"就是盗跖的并且在从账本上可知这张"1块钱"从未被使用过。交易可顺利完成：盗跖获得西瓜，张记获得"1块钱"；账本上新添一笔交易"1块钱"已被消费并有盗跖的签名。当盗跖在李家酒铺故伎重演时，李家在账本上查到"1块钱"已被使用，而且盗跖不能否认之前交易存在。交易失败，盗跖的"双花"行为被制止。同样，盗跖想用不存在的五元在肉铺消费，王哥只需一查账本便可识破盗跖的伎俩。

![](/assets/fig-4-2.png)

_图4-2：数字货币交易示意图。交易①可顺利，因为张记查账本确认货币未被花费；交易后，此货币记录为已花费。交易②无法完成，因为王哥查到货币已被花费了。交易③无法完成，因为账本没有该货币的信息。_

区块链可以近似想象成这个信息一致且人手一本的神奇小账本，账本内容可认证且不可抵赖。所有的交易都记录在案且人人可查，“双花”便无处可匿了。

#### 4.1.2 传统记账模式 V.S. 比特币记账模式

上一节说到如果每人都拥有一个信息一致且可认证不可抵赖的账本，就可解决数字货币普遍存在的"双花"问题。可认证不可抵赖有数字签名解决，那么信息一致又如何做到呢？在这个场景中，该问题更具体的说法是“谁来记账？”以及“记账信息如何让每个人保持一致？”；两个问题是有关联的，“谁来记账”决定着后者实现的方式。

在上一节例子中，如果没有附加条件，那么无论是盗跖或是张记等由他们记账都是不可信任的；因为每个人都有徇私做假账的动机。面对这种情况，传统模式并不会消除盗跖等做假账的动机，而是将记账工作交给一个可信任的第三方权威中心机构来处理；在比特币模式下则相反，它通过对游戏规则的制定来消除低信任度人群做假账的动机。下面就让我们对比一下这两种解决方案。

##### 传统模式

由可信任的第三方权威中心机构记账，例如银行。银行用资产负债表来维护着每个用户的账户：当交易发生时，在支付方账户中减去交易额度，在接收方账户中加上相等额度。由于所有的信息都由一个中心来处理，所以每个人只需要从中心实时更新本地数据即可保持信息的一致。这也是e-money实现所采用的方法。再次回到3.1.1的例子，假设所有参与者都是银行A的用户：盗跖的存款只够前两笔交易，第三笔交易余额不足。下图是例子中3笔交易在银行系统中的记账过程。银行A账本：

![](/assets/ffig-4-3%284%29.png)

![](/assets/ffig-4.5.png)

从上面图示可知，交易的发生意味着货币的流通，但货币总量保持不变，不会发生“双花”问题。

传统模式下的第三方权威中心机构之所以值得信任：以自身的权威声誉作担保以保证记账的真实性；只要越多人信赖它的记账并使用，它就能获取更多的手续费（现实中银行会从每笔交易中抽取一定的份额作为手续费）。也即是说，一旦它做了假账声名狼籍，那么它就失去了获利的途径。

传统模式的好处就在于中心化系统实现起来相对容易并有多年的经验积累，但也存在弊端。比如说黑客攻克了银行系统的数据中心，删改了账本上面的条目，那么原来的数据就永久性地丢失了；毕竟中心化的账本就这么一两个备份。另一方面，由于银行掌握着记账这个垄断权力，相比普通的用户它在服务议价上拥有压倒性的优势，比如说人人诟病的小额账户管理费。因此，人们开始想是否不需要一个中心化的权威机构也能正确记账呢？这就是下面要介绍的比特币记账模式。

##### 比特币记账模式

比特币不是某个国家或权威组织发行的货币，并且它没有一个中心化的权威机构记账，换句时髦的话说它是去中心的。在该模式下，人人竞争记账，也即是盗跖，张记，甚至银行，又或是与交易毫不相关的人员都有成为记账者的可能。那它是怎么做到让低信用人群诚实记账的呢？让做假账的成本远高于它成功所带来的期望利益；用诱人的期望奖赏来激励诚实记账维护系统的人：这是解决问题的核心思想。

在比特币系统中做假账的成本是非常高的，需要控制整个网络51％或以上的计算能力。根据历史数据，平均单笔比特币交易额约为3,213美元，为了蝇头小利而对整个系统发动攻击得不偿失。此外，中本聪还有大招未放，就是比特币区块链的激励机制：

（1）最快算出新区块头散列值，也即是记账成功的矿工能获得新产生的比特币，截止到现在（2016年9月）是每个区块12.5BTC；

（2）所有包含在该区块中交易的手续费。

激励机制用新发行的比特币和交易手续费来激励诚实记账的人，这能带来以下积极的效果：

（1）越来越多的人受利益驱使加入到记账行列，也即是后面提及的挖矿（mining）。盗跖或任何人想控制51％或以上的计算能力将越来越难；

（2）从源头上消除了盗跖之流攻击系统的动机。试想一下，若盗跖掌握了系统50％或以上的计算能力，她是遵循系统的规则，能挣取源源不断的激励（计算能力所占比例越大，能获取激励的可能性也越大且次数也越多）；还是为了蝇头小利的"1块钱"导致整个系统失去信用，自身拥有的数字货币也一文不值呢？假设盗跖是理性的，自然选择收益更多的前者; 假设不成立，系统也有自身的反攻击能力，详细解释请参见5.1.3.2章节。

从利益的源头上消除了低信任度人群做假账的动机。之后，系统信息的传播和全体诚实节点达成共识的机制就运用到了上一章介绍的采用了POW机制抵挡女巫攻击的拜占庭将军模型，具体实现过程请参见第五章内容。

以上从宏观层面概述了比特币（区块链）系统如何解决"双花"问题。本章的剩下内容将会介绍比特币系统的账本。在第五章将会依次介绍比特币系统中的节点：全节点，挖矿节点以及轻量级的钱包节点。除此之外，比特币去中心化的网络部分也将放在下一章。



